!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.opensoql=t():e.opensoql=t()}(this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";n.r(t),n.d(t,"applyWhereConditions",(function(){return Q})),n.d(t,"applyHavingConditions",(function(){return U})),n.d(t,"getIndexFieldConditions",(function(){return B})),n.d(t,"sortRecords",(function(){return W})),n.d(t,"build",(function(){return Wn})),n.d(t,"setDefaultStaticResolverConfig",(function(){return wr})),n.d(t,"staticJsonResolverBuilder",(function(){return xr})),n.d(t,"staticCsvResolverBuilder",(function(){return Nr})),n.d(t,"passThroughResolverBuilder",(function(){return _r}));const r=Function("return this")(),o={}.constructor,s=Function,a=/^(\d{4}-[01]\d-[0-3]\d)$/,i=/^((?:(?:\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+)|(?:\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d)|(?:\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d))(?:[+-][0-2]\d:[0-5]\d|Z))$/,l={};function c(e,t){if(e===r||"__proto__"===t||"__defineGetter__"===t||"__defineSetter__"===t||"__lookupGetter__"===t||"__lookupSetter__"===t)return!0;if(!("prototype"!==t&&"constructor"!==t||null!=e&&"function"!=typeof e))return!0;if((null==e||e===o)&&o.hasOwnProperty(t))return!0;if(null==e||e===s){let e=s;for(;e;){if(e.hasOwnProperty(t))return!0;e=e.__proto__}}return"function"==typeof e&&!e.hasOwnProperty(t)}function u(e){switch(typeof e){case"object":if(Array.isArray(e))return e.slice().map(e=>u(e));if(null===e)return e;if(e instanceof Map){const t=Array.from(e.entries()).map(e=>[u(e[0]),u(e[1])]);return new Map(t)}if(e instanceof Set){const t=Array.from(e.values()).map(e=>u(e));return new Set(t)}{const t={};for(const n of Object.keys(e))t[n]=u(e[n]);return t}default:return e}}function f(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n].toLowerCase()!==t[n].toLowerCase())return!1;return!0}function d(e,t){const n=[];for(let r=0;r<e.length;r++){const o=e.slice(r);if(f(t.slice(0,o.length),o))break;n.push(e[r])}return n.length?n.concat(t):t}function p(e,t){const n=Object.keys(e),r=t.toLowerCase(),o=n.findIndex(e=>e.toLowerCase()===r);return 0>o?null:n[o]}function m(e,t){const n=Object.keys(e),r=t.toLowerCase(),o=n.findIndex(e=>e.toLowerCase()===r);return 0>o?null:e[n[o]]}function h(e,t,n){const r=n.toLowerCase();return e.has(r)?t[e.get(r)]:null}function g(e,t){const n=[];let r=e;for(const e of t){if(null==r)return null;const t=Object.keys(r),o=e.toLowerCase(),s=t.findIndex(e=>e.toLowerCase()===o);if(0>s)return null;r=r[t[s]],n.push(t[s])}return n}function y(e,t){let n=e;for(const e of t)if(n=n[e],null==n)return null;return n}function w(e,t){let n=e;for(const e of t){const t=Object.keys(n),r=e.toLowerCase(),o=t.findIndex(e=>e.toLowerCase()===r);if(0>o)return null;if(n=n[t[o]],null==n)return null}return n}function b(e){switch(e.op){case"true":return!1;case"not":case"and":case"or":if(0===e.operands.length)return!1}return!0}function v(e,t){if(t.operands.length){const n=t.operands[0];switch(typeof n){case"object":if(null===n);else if(Array.isArray(n));else switch(n.type){case"field":if(!f(e,n.name.slice(0,n.name.length-1)))return{type:"condition",op:"true",operands:[]};n.name=n.name.slice(n.name.length-1);break;case"fncall":{const t=function e(t,n){for(const r of n.args)switch(typeof r){case"object":if(null===r);else switch(r.type){case"field":if(!f(t,r.name.slice(0,r.name.length-1)))return{type:"condition",op:"true",operands:[]};r.name=r.name.slice(r.name.length-1);break;case"fncall":{const n=e(t,r);if(n)return n}}}return null}(e,n);if(t)return t}}}}return function(e,t){return t.operands=t.operands.map(t=>{switch(typeof t){case"object":if(Array.isArray(t))return t;if(null===t)return t;switch(t.type){case"condition":return v(e,t);default:return t}default:return t}}).filter(e=>{switch(typeof e){case"object":if(null!==e&&!Array.isArray(e)&&"condition"===e.type)return b(e)}return!0}),t}(e,t)}function A(e,t,n){const r=(t,n)=>{const r=[];A(r,t,n),n.operands=r,"and"!==t&&"or"!==t||1!==r.length?e.push(n):e.push(r[0])};switch(n.op){case"and":case"or":case"not":n.op===t?(()=>{for(const o of n.operands)switch(typeof o){case"object":if(null===o||Array.isArray(o))throw new Error("Unexpected AST is found.");switch(o.type){case"condition":switch(o.op){case"and":case"or":case"not":"not"!==o.op&&o.op===t?A(e,o.op,o):r(o.op,o);break;default:e.push(o)}break;default:throw new Error(`Unexpected AST ${o.type} is found.`)}break;default:throw new Error("Unexpected AST is found.")}})():r(n.op,n);break;default:e.push(n)}}function k(e,t){if(e.operands.length){const n=e.operands[0];switch(typeof n){case"object":if(null===n||Array.isArray(n))return{type:"condition",op:"true",operands:[]};switch(n.type){case"field":if(!t.includes(n.name[n.name.length-1].toLowerCase()))return{type:"condition",op:"true",operands:[]};break;case"fncall":return{type:"condition",op:"true",operands:[]}}break;default:return{type:"condition",op:"true",operands:[]}}}return function(e,t){return e.operands=e.operands.map(e=>{switch(typeof e){case"object":if(Array.isArray(e))return e;if(null===e)return e;switch(e.type){case"condition":return k(e,t);default:return e}default:return e}}).filter(e=>{switch(typeof e){case"object":if(null!==e&&!Array.isArray(e)&&"condition"===e.type)return b(e)}return!0}),e}(e,t)}const x=new WeakMap,N=new WeakMap,_=new WeakMap,C=new WeakMap;function F(e,t,n,r,o,s){const a=t.args.map(t=>{var n;switch(typeof t){case"object":if(null===t)return t;switch(t.type){case"field":{let e=m(o,t.name[t.name.length-1]);switch(r){case"date":case"datetime":e=new Date(e).getTime()}return e}case"date":case"datetime":switch(r){case"date":case"datetime":return new Date(t.value).getTime();default:return t.value}case"parameter":{if(!Object.prototype.hasOwnProperty.call(e.params,t.name))throw new Error(`Parameter '${t.name}' is not found.`);const o=null!==(n=e.params[t.name])&&void 0!==n?n:null;if(null===o)return null;switch(r){case"date":case"datetime":if(Array.isArray(o))throw new Error(`Parameter '${t.name}' should be string or number.`);return new Date(o).getTime();default:return o}}case"fncall":{let n=_.get(t);if(!n){const r=t.fn.toLowerCase();n=e.functions.find(e=>e.name.toLowerCase()===r)}const r=n;switch(null==r?void 0:r.type){case"aggregate":if(!s)throw new Error(`Nested function ${t.fn} is not allowed.`);return O(e,t,r,"any",s);case"scalar":return F(e,t,r,"any",o,s);case"immediate-scalar":return P(e,t,r,"any",o,s);default:throw new Error(`Nested function ${t.fn} is not allowed.`)}}default:return t}default:return t}});return n.fn(e,a,o)}function P(e,t,n,r,o,s){const a=C.get(t.args);if(a)return a.value;let i=!1;const l=t.args.map(t=>{var n;switch(typeof t){case"object":if(null===t)return t;switch(t.type){case"field":throw new Error(`Immediate scalar function should not refer the field (${t.name.join(".")}).`);case"date":case"datetime":switch(r){case"date":case"datetime":return new Date(t.value).getTime();default:return t.value}case"parameter":{if(i=!0,!Object.prototype.hasOwnProperty.call(e.params,t.name))throw new Error(`Parameter '${t.name}' is not found.`);const o=null!==(n=e.params[t.name])&&void 0!==n?n:null;if(null===o)return null;switch(r){case"date":case"datetime":if(Array.isArray(o))throw new Error(`Parameter '${t.name}' should be string or number.`);return new Date(o).getTime();default:return o}}case"fncall":{null===s&&null===o||(i=!0);let n=_.get(t);if(!n){const r=t.fn.toLowerCase();n=e.functions.find(e=>e.name.toLowerCase()===r)}const r=n;switch(null==r?void 0:r.type){case"aggregate":if(null===s)throw new Error(`Nested function ${t.fn} is not allowed.`);return O(e,t,r,"any",s);case"scalar":if(null===o)throw new Error(`Nested function ${t.fn} is not allowed.`);return F(e,t,r,"any",o,s);case"immediate-scalar":return P(e,t,r,"any",o,s);default:throw new Error(`Nested function ${t.fn} is not allowed.`)}}default:return t}default:return t}}),c=n.fn(e,l);return i||C.set(t.args,{value:c}),c}function O(e,t,n,r,o){const s=t.args.map(t=>{var n;switch(typeof t){case"object":if(null===t)return t;switch(t.type){case"field":{let e=o.map(e=>m(e,t.name[t.name.length-1]));switch(r){case"date":case"datetime":e=e.map(e=>new Date(e).getTime())}return e}case"date":case"datetime":switch(r){case"date":case"datetime":return new Date(t.value).getTime();default:return t.value}case"parameter":{if(!Object.prototype.hasOwnProperty.call(e.params,t.name))throw new Error(`Parameter '${t.name}' is not found.`);const o=null!==(n=e.params[t.name])&&void 0!==n?n:null;if(null===o)return null;switch(r){case"date":case"datetime":if(Array.isArray(o))throw new Error(`Parameter '${t.name}' should be string or number.`);return new Date(o).getTime();default:return o}}case"fncall":{let n=_.get(t);if(!n){const r=t.fn.toLowerCase();n=e.functions.find(e=>e.name.toLowerCase()===r)}const r=n;switch(null==r?void 0:r.type){case"scalar":return o.map(n=>F(e,t,r,"any",n,o));case"immediate-scalar":return o.map(n=>P(e,t,r,"any",n,o));default:throw new Error(`Nested function ${t.fn} is not allowed.`)}}default:return t}default:return t}});return n.fn(e,s,o)}function j(e,t){if(e.has(t)){const n=e.get(t);if(n)return n}return null}function E(e,t,n){for(const r of n)switch(typeof r){case"object":switch(null==r?void 0:r.type){case"field":if(!j(t,r.name[r.name.length-1]))return!1;break;case"fncall":{const n=r.fn.toLowerCase(),o=e.functions.find(e=>e.name.toLowerCase()===n);switch(null==o?void 0:o.type){case"scalar":if(!E(e,t,r.args))return!1}}}}return!0}const T=(e,t,n,r)=>{},D=(e,t,n,r)=>{const{op:o,op2FieldResultType:s,fnInfo:a}=n;return O(t,o,a,s,r)},S=(e,t,n,r)=>{const{op:o,op2FieldResultType:s,fnInfo:a}=n;return F(t,o,a,s,r[0],r)},L=(e,t,n,r)=>{const{op:o,op2FieldResultType:s,fnInfo:a}=n;return F(t,o,a,s,r,null)},$=(e,t,n,r)=>{const{op:o,op2FieldResultType:s,fnInfo:a}=n;return P(t,o,a,s,null,r)},I=(e,t,n,r)=>{const{op:o,op2FieldResultType:s,fnInfo:a}=n;return P(t,o,a,s,r,null)};function q(e,t,n,r,o,s){var a;let i=null;const l=o.operands[0],c=null!==(a=x.get(o))&&void 0!==a?a:function(e,t,n,r){let o=x.get(r);const s=r.operands[0],a=r.operands[1];let i=!1,l="any";switch(typeof a){case"object":if(null===a);else if(Array.isArray(a));else switch(a.type){case"date":case"datetime":i=!0,l=a.type}}switch(typeof s){case"object":if(null===s);else{if(Array.isArray(s))throw new Error("Array is not allowed in the operand(1).");switch(s.type){case"field":o={isField:!0,isDateOrDatetime:i,op:s,op2FieldResultType:l,fnInfo:null,fn:T},x.set(r,o);break;case"fncall":{const a=s.fn.toLowerCase(),i=n.functions.find(e=>e.name.toLowerCase()===a);switch(null==i?void 0:i.type){case"aggregate":if(!t)throw new Error(`Aggregate function ${i.name} is not allowed.`);o={isField:!1,isDateOrDatetime:!1,op:s,op2FieldResultType:l,fnInfo:i,fn:D},x.set(r,o);break;case"scalar":if(t){if(!E(n,e,s.args))throw new Error(s.fn+" is not allowed. Aggregate function is needed.");o={isField:!1,isDateOrDatetime:!1,op:s,op2FieldResultType:l,fnInfo:i,fn:S},x.set(r,o)}else o={isField:!1,isDateOrDatetime:!1,op:s,op2FieldResultType:l,fnInfo:i,fn:L},x.set(r,o);break;case"immediate-scalar":o={isField:!1,isDateOrDatetime:!1,op:s,op2FieldResultType:l,fnInfo:i,fn:t?$:I},x.set(r,o);break;default:throw new Error("Unexpected type appears in the operand(1).")}}break;default:throw new Error("Unexpected type appears in the operand(1).")}}break;default:throw new Error("Unexpected type appears in the operand(1).")}return o}(t,n,r,o);if(null===l);else{if(Array.isArray(l))throw new Error("Array is not allowed in the operand(1).");if(c.isField){const{isDateOrDatetime:t,op:n}=c;i=h(e,s,n.name[n.name.length-1]),t&&null!==i&&(i=new Date(i).getTime())}else i=c.fn(e,r,c,s)}return i}function M(e,t,n,r,o,s){return R(e,t,n,r,o,s)}function R(e,t,n,r,o,s){let a=!0;e:switch(o.op){case"true":break;case"and":for(const i of o.operands)if(!M(e,t,n,r,i,s)){a=!1;break e}break;case"or":for(const a of o.operands)if(M(e,t,n,r,a,s))break e;a=!1;break;case"not":a=!M(e,t,n,r,o.operands[0],s);break;default:{const i=q(e,t,n,r,o,s),l=function(e,t,n){var r;const o=N.get(t);if(o)return o.value;let s=null;const a=t.operands[1];switch(typeof a){case"object":if(null===a);else if(Array.isArray(a))s=a.map(t=>{var n;if(null===t)return null;switch(typeof t){case"object":switch(t.type){case"date":case"datetime":return t.value;case"parameter":{if(!Object.prototype.hasOwnProperty.call(e.params,t.name))throw new Error(`Parameter '${t.name}' is not found.`);const r=null!==(n=e.params[t.name])&&void 0!==n?n:null;if(Array.isArray(r))throw new Error(`Parameter '${t.name}' items should be atom.`);return r}}default:return t}});else switch(a.type){case"fncall":{const t=a.fn.toLowerCase(),n=e.functions.find(e=>e.name.toLowerCase()===t);switch(null==n?void 0:n.type){case"immediate-scalar":s=P(e,a,n,"any",null,null);break;default:throw new Error("Unexpected type appears in the operand(2).")}}default:switch(a.type){case"date":case"datetime":s=new Date(a.value).getTime();break;case"parameter":if(!Object.prototype.hasOwnProperty.call(e.params,a.name))throw new Error(`Parameter '${a.name}' is not found.`);s=null!==(r=e.params[a.name])&&void 0!==r?r:null;break;default:throw new Error("Unexpected type appears in the operand(2).")}}break;default:s=a}switch(t.op){case"like":case"not_like":if("string"!=typeof s)throw new Error(`Operator "${t.op}": operand(2) should be string.`);s=new RegExp(function(e){const t=e.replace(/[.*+?^=!:${}()|[\]\/]/g,"\\$&");let n="",r=void 0;for(const e of t){switch(e){case"%":n+="\\"===r?"%":".*";break;case"_":n+="\\"===r?"_":".";break;case"\\":break;default:"\\"===r&&(n+="\\"),n+=e}r=e}"\\"===r&&(n+="\\");return`^${n}$`}(s),"i");break;case"in":case"not_in":if(!Array.isArray(s))throw new Error(`Operator "${t.op}": operand(2) should be array.`);break;case"includes":case"excludes":if(!Array.isArray(s))throw new Error(`Operator "${t.op}": operand(2) should be array.`);s=s.map(e=>{if("string"!=typeof e)throw new Error(`Operator "${t.op}": operand(2) array items should be string.`);return e.split(";")})}return N.set(t,{value:s}),s}(r,o);switch(o.op){case"=":i!==l&&(a=!1);break;case"!=":i===l&&(a=!1);break;case"<":if(null===i){a=!1;break}if(null===l){a=!1;break}i<l||(a=!1);break;case"<=":if(null===i){a=!1;break}if(null===l){a=!1;break}i<=l||(a=!1);break;case">":if(null===i){a=!1;break}if(null===l){a=!1;break}i>l||(a=!1);break;case">=":if(null===i){a=!1;break}if(null===l){a=!1;break}i>=l||(a=!1);break;case"like":if("string"!=typeof i){a=!1;break}l.test(i)||(a=!1);break;case"not_like":if("string"!=typeof i){a=!1;break}l.test(i)&&(a=!1);break;case"in":l.filter(e=>null!==e).includes(i)||(a=!1);break;case"not_in":if(null===i){a=!1;break}if(l.includes(null)){a=!1;break}l.includes(i)&&(a=!1);break;case"includes":if("string"!=typeof i){a=!1;break}a=!1;t:for(const e of l){const t=i.split(";");for(const n of e)if(!t.includes(n))continue t;a=!0;break}break;case"excludes":if("string"!=typeof i){a=!1;break}{const e=i.split(";");for(const t of l){let n=!0;for(const r of t)if(!e.includes(r)){n=!1;break}if(n){a=!1;break}}}}}}return a}function Q(e,t,n){const r=[];if(!n.length)return r;const o=new Map(Object.keys(n[0]).map(e=>[e.toLowerCase(),e]));e:for(const s of n){for(const n of t)if(!R(o,null,!1,e,n,s))continue e;r.push(s)}return r}function U(e,t,n){var r,o;const s=[];if(!n.length)return s;const a=new Map(Object.keys(n[0][0]).map(e=>[e.toLowerCase(),e])),i=n[0][0],l=new Map(null===(o=null===(r=e.query)||void 0===r?void 0:r.groupBy)||void 0===o?void 0:o.map(e=>{var t;return[e.toLowerCase(),null!==(t=p(i,e))&&void 0!==t?t:""]}));e:for(const r of n){for(const n of t)if(!R(a,l,!0,e,n,r))continue e;s.push(r)}return s}function B(e,t){const n=t.map(e=>e.toLowerCase()),r=[];return A(r,"and",k({type:"condition",op:"and",operands:u(e)},n)),r}function W(e,t){if(e.orderBy&&t.length){const n=e.from[0].name.length,r=e.orderBy,o=(e,t)=>"desc"===e.direction?-t:t,s=r.map(e=>({f:e,fName:g(t[0],e.name.slice(n))}));t=t.sort((e,t)=>{e:for(let r=0;r<s.length;r++){let{f:a,fName:i}=s[r],l=null,c=null;if(null!==i?(l=y(e,i),c=y(t,i)):(l=w(e,a.name.slice(n)),s[r].fName=i=g(t,a.name.slice(n)),c=null!==i?y(t,i):null),l!==c){if(null===l)return o(a,"last"===a.nulls?1:-1);if(null===c)return o(a,"last"===a.nulls?-1:1);switch(typeof l){case"number":case"bigint":return o(a,l-c);case"string":return o(a,l>c?1:-1);default:continue e}}}return 0})}return t}class z extends Error{constructor(e){super(e.message),this.result=e}}function J(e,t){return{src:e,start:0,end:e.length,context:t,templateArgs:[],templateArgsPos:[]}}function Y(e){let t="",n="";if("string"==typeof e.src){n=e.src.slice(Math.max(e.pos-5,0),e.pos+55);let r=n.split(/\r\n|\n|\r/);r=r.slice(0,1).concat("          ^~~~~~~~").concat(...r.slice(1)),n=r.join("\n")+"\n\n";const o=function(e,t){let n=1,r=1;for(let o=0;o<=t;o++)switch(e[o]){case"\r":"\n"===e[o+1]&&o++;case"\n":n++,r=1;break;default:r++}return{line:n,col:r}}(e.src,e.pos);t=`parse failed at position:${e.pos} line:${o.line} col:${o.col} ${e.message?" "+e.message:""}\n     ${n}`}else{n="     (object)\n          ^~~~~~~~";try{n="     "+JSON.stringify(e.src.slice(Math.max(e.pos-10,0),e.pos))+"\n          "+JSON.stringify(e.src.slice(e.pos,e.pos+1))+"\n          "+JSON.stringify(e.src.slice(e.pos+1,e.pos+10));let t=n.split(/\r\n|\n|\r/);t=t.slice(0,2).concat("          ^~~~~~~~").concat(...t.slice(2)),n=t.join("\n")+"\n\n"}catch(e){}t=`parse failed at position:${e.pos} ${e.message?" "+e.message:""}\n     ${n}`}return t}function Z(e){return t=>({succeeded:!0,next:{src:t.src,start:t.start,end:t.end,context:t.context,templateArgs:t.templateArgs,templateArgsPos:t.templateArgsPos},tokens:e?[e()]:[]})}function H(e){return t=>{throw new z({succeeded:!1,error:!0,src:t.src,pos:t.start,message:e||""})}}function G(e){return t=>0===t.start?{succeeded:!0,next:{src:t.src,start:t.start,end:t.end,context:t.context,templateArgs:t.templateArgs,templateArgsPos:t.templateArgsPos},tokens:e?[e()]:[]}:{succeeded:!1,error:!1,src:t.src,pos:t.start,message:'operator "beginning"'}}function K(e){return t=>t.start===t.end?{succeeded:!0,next:{src:t.src,start:t.start,end:t.end,context:t.context,templateArgs:t.templateArgs,templateArgsPos:t.templateArgsPos},tokens:e?[e()]:[]}:{succeeded:!1,error:!1,src:t.src,pos:t.start,message:'operator "end"'}}function V(e,t){return e=e||0,n=>r=>{let o=r;const s=[];for(;;){const r=n(o);if(!r.succeeded){if(r.error)return r;if(s.length>=e)break;return{succeeded:!1,error:!1,src:o.src,pos:o.start,message:'operator "quantify"'}}if(o=r.next,s.push({next:r.next,tokens:r.tokens}),t&&t===s.length)break}if(s.length>0){const e=[];for(const t of s)e.push(...t.tokens);return{succeeded:!0,next:s[s.length-1].next,tokens:e}}return{succeeded:!0,next:{src:r.src,start:r.start,end:r.end,context:r.context,templateArgs:r.templateArgs,templateArgsPos:r.templateArgsPos},tokens:[]}}}function X(...e){return t=>{let n=null,r=null;for(const o of e){const e=o(t);if(e.succeeded){n={next:e.next,tokens:e.tokens};break}r?e.error?(!r.error||r.pos<e.pos)&&(r=e):r.pos<e.pos&&(r=e):r=e}return n?{succeeded:!0,next:n.next,tokens:n.tokens}:r||{succeeded:!1,error:!1,src:t.src,pos:t.start,message:'operator "first"'}}}function ee(...e){return t=>{const n=[];let r=null;for(const o of e){const e=o(t);e.succeeded?n.push({next:e.next,tokens:e.tokens}):r?e.error?(!r.error||r.pos<e.pos)&&(r=e):r.pos<e.pos&&(r=e):r=e}if(n.length>0){const e=n.reduce((e,t)=>e.next.start>=t.next.start?e:t);return{succeeded:!0,next:e.next,tokens:e.tokens}}return r||{succeeded:!1,error:!1,src:t.src,pos:t.start,message:'operator "or"'}}}function te(e,t){return(...n)=>r=>{let o=r;const s=[];for(const e of n){const t=e(o);if(!t.succeeded)return t;o=t.next,s.push(...t.tokens)}const a=e?e(s,r):s;return{succeeded:!0,next:t?{src:o.src,start:o.start,end:o.end,context:t(o.context),templateArgs:o.templateArgs,templateArgsPos:o.templateArgsPos}:o,tokens:a}}}function ne(...e){return t=>{let n=t;for(const t of e){const e=t(n);if(!e.succeeded)return e;n=e.next}return{succeeded:!0,next:t,tokens:[]}}}function re(e,t){return(...n)=>r=>{if(r.start-e<0)return{succeeded:!1,error:!1,src:r.src,pos:r.start,message:"lookBehind: src is too short"};let o={src:r.src,start:r.start-e,end:r.end,context:r.context,templateArgs:r.templateArgs,templateArgsPos:r.templateArgsPos};for(const e of n){const t=e(o);if(!t.succeeded)return t;o=t.next}return{succeeded:!0,next:r,tokens:t?[t()]:[]}}}function oe(e){return t=>n=>{const r=t(n);if(!r.succeeded)return r;const o=J(r.tokens,n.context);let s=o,a=!1;if(e.check(s).succeeded)return{succeeded:!0,next:r.next,tokens:r.tokens};e:for(let t=0;void 0===e.maxApply||t<e.maxApply;t++){let t=!1;t:for(const n of e.rules){const{parser:r,rtol:o}="function"==typeof n?{parser:n,rtol:!1}:n,i=s.src.length;for(let n=0;n<=i;n++){const l=r({src:s.src,start:o?i-n:n,end:s.src.length,context:s.context,templateArgs:s.templateArgs,templateArgsPos:s.templateArgsPos});if(l.succeeded){t=!0;const r=s.src.slice(0,o?i-n:n);if(r.push(...l.tokens),r.push(...s.src.slice(l.next.start)),s={src:r,start:0,end:r.length,context:l.next.context,templateArgs:l.next.templateArgs,templateArgsPos:l.next.templateArgsPos},e.check(s).succeeded){a=!0;break e}break t}}}if(!t)break}if(!a&&!e.check(s).succeeded)throw new z({succeeded:!1,error:!0,src:o.src,pos:o.start,message:"The application of production rules was not finished"});return{succeeded:!0,next:r.next,tokens:s.src}}}function se(e){return t=>{try{return e(t)}catch(e){if(e.result)return e.result;throw e}}}function ae(e,t){return n=>{if("\0"===n.src.slice(n.start,n.start+1)&&n.templateArgsPos){let r=-1;if(0<=n.templateArgsPos.findIndex((e,t)=>(r=t,e===n.start))){const o=n.templateArgs[r];if(e(o))return{succeeded:!0,next:{src:n.src,start:n.start+1,end:n.end,context:n.context,templateArgs:n.templateArgs,templateArgsPos:n.templateArgsPos},tokens:[t?t(o):o]}}}return{succeeded:!1,error:!1,src:n.src,pos:n.start,message:'operator "stringTemplatesParam()"'}}}function ie(e){const t=(n=e.rawToToken,e=>t=>t.src.slice(t.start,t.end).startsWith(e)?{succeeded:!0,next:{src:t.src,start:t.start+e.length,end:t.end,context:t.context,templateArgs:t.templateArgs,templateArgsPos:t.templateArgsPos},tokens:[n(e)]}:{succeeded:!1,error:!1,src:t.src,pos:t.start,message:`operator "charSequence(${e})"`});var n;const r=function(e){return(...t)=>n=>{const r=n.src.slice(n.start,n.end);let o=-1;return t.some((e,t)=>{if(r.startsWith(e))return o=t,!0})?{succeeded:!0,next:{src:n.src,start:n.start+t[o].length,end:n.end,context:n.context,templateArgs:n.templateArgs,templateArgsPos:n.templateArgsPos},tokens:[e(t[o])]}:{succeeded:!1,error:!1,src:n.src,pos:n.start,message:`operator "charClass(${t.join(",")})"`}}}(e.rawToToken),o=function(e){return(...t)=>n=>{const r=n.src.slice(n.start,n.end);for(const e of t){if(r.startsWith(e))return{succeeded:!1,error:!1,src:n.src,pos:n.start,message:`operator "charClassNot(${t.join(",")})"`}}const o=n.src.codePointAt(n.start);if(void 0===o)return{succeeded:!1,error:!1,src:n.src,pos:n.start,message:`operator "charClassNot(${t.join(",")})"`};const s=String.fromCodePoint(o);return{succeeded:!0,next:{src:n.src,start:n.start+s.length,end:n.end,context:n.context,templateArgs:n.templateArgs,templateArgsPos:n.templateArgsPos},tokens:[e(s)]}}}(e.rawToToken),s=function(e){return t=>n=>{const r=n.src.slice(n.start,n.end),o=t(r);return o>=0?{succeeded:!0,next:{src:n.src,start:n.start+o,end:n.end,context:n.context,templateArgs:n.templateArgs,templateArgsPos:n.templateArgsPos},tokens:[e(r.substring(0,o))]}:{succeeded:!1,error:!1,src:n.src,pos:n.start,message:'operator "charClassByNeedleFn"'}}}(e.rawToToken),a=te(e.concatTokens),i=V(1,1),l=V(),c=(e,t)=>V(e,t),u=te(),f=te(e=>[]),d=s(e=>{const t=e.codePointAt(0);if(void 0===t)return-1;const n=String.fromCodePoint(t);return"A"<=n&&n<="Z"||"a"<=n&&n<="z"?n.length:-1}),p=s(e=>{const t=e.codePointAt(0);if(void 0===t)return-1;const n=String.fromCodePoint(t);return"A"<=n&&n<="Z"?n.length:-1}),m=s(e=>{const t=e.codePointAt(0);if(void 0===t)return-1;const n=String.fromCodePoint(t);return"a"<=n&&n<="z"?n.length:-1}),h=s(e=>{const t=e.codePointAt(0);if(void 0===t)return-1;const n=String.fromCodePoint(t);return"0"<=n&&n<="9"?n.length:-1}),g=s(e=>{const t=e.codePointAt(0);if(void 0===t)return-1;const n=String.fromCodePoint(t);return"1"<=n&&n<="9"?n.length:-1}),y=s(e=>{const t=e.codePointAt(0);if(void 0===t)return-1;const n=String.fromCodePoint(t);return"0"<=n&&n<="1"?n.length:-1}),w=s(e=>{const t=e.codePointAt(0);if(void 0===t)return-1;const n=String.fromCodePoint(t);return"0"<=n&&n<="7"?n.length:-1}),b=s(e=>{const t=e.codePointAt(0);if(void 0===t)return-1;const n=String.fromCodePoint(t);return"A"<=n&&n<="F"||"a"<=n&&n<="f"||"0"<=n&&n<="9"?n.length:-1}),v=s(e=>{const t=e.codePointAt(0);if(void 0===t)return-1;const n=String.fromCodePoint(t);return"A"<=n&&n<="Z"||"a"<=n&&n<="z"||"0"<=n&&n<="9"?n.length:-1}),A=s(e=>{const t=e.codePointAt(0);if(void 0===t)return-1;const n=String.fromCodePoint(t);return" \f\n\r\t\v​  ​᠎           ​\u2028\u2029  ​　\ufeff".includes(n)?n.length:-1}),k=s(e=>{const t=e.codePointAt(0);if(void 0===t)return-1;const n=String.fromCodePoint(t);return" \f\t\v​  ​᠎           ​\u2028\u2029  ​　\ufeff".includes(n)?n.length:-1}),x=s(e=>{const t=e.codePointAt(0);if(void 0===t)return-1;const n=String.fromCodePoint(t);return 0<=t&&t<=31||127<=t&&t<=159?n.length:-1}),N=s(e=>{const t=e.codePointAt(0);if(void 0===t)return-1;const n=String.fromCodePoint(t);return" \f\n\r\t\v​  ​᠎           ​\u2028\u2029  ​　\ufeff".includes(n)||0<=t&&t<=31||127<=t&&t<=159?-1:n.length}),_=r("\r\n","\n","\r"),C=s(e=>{const t=e.codePointAt(0);if(void 0===t)return-1;return String.fromCodePoint(t).length}),F=X(y,r("_")),P=X(w,r("_")),O=X(b,r("_")),j=u(a(c(0,1)(r("+","-")),X(u(i(g),l(X(h,r("_")))),t("0")))),E=u(a(j,f(t("n")))),T=u(a(c(0,1)(r("+","-")),X(u(i(g),l(X(h,r("_")))),t("0")),c(0,1)(u(t("."),c(1)(X(h,r("_"))))),c(0,1)(u(r("E","e"),c(0,1)(r("+","-")),X(u(i(g),l(h)),t("0"))))));return{seq:t,cls:r,notCls:o,clsFn:s,classes:{alpha:d,upper:p,lower:m,num:h,nonzero:g,bin:y,oct:w,hex:b,alnum:v,space:A,spaceWithinSingleLine:k,ctrl:x,newline:_,word:N,any:C},numbers:{bin:(...e)=>u(f(X(...e)),a(i(y),l(F))),oct:(...e)=>u(f(X(...e)),a(i(w),l(P))),hex:(...e)=>u(f(X(...e)),a(i(b),l(O))),int:j,bigint:E,float:T},isParam:ae,cat:a,once:i,repeat:l,qty:c,zeroWidth:e=>Z(e),err:e=>H(e),beginning:e=>G(e),end:e=>K(e),first:(...e)=>X(...e),or:(...e)=>ee(...e),combine:u,erase:f,trans:e=>te(e),ahead:(...e)=>ne(...e),behind:(e,t)=>re(e,t),rules:e=>oe(e),makeProgram:se}}function le(e,t){return n=>r=>{let o=!0;if(Math.max(0,r.end-r.start)>=n.length){for(let e=0;e<n.length;e++)if(!t(r.src[r.start+e],n[e])){o=!1;break}}else o=!1;return o?{succeeded:!0,next:{src:r.src,start:r.start+n.length,end:r.end,context:r.context,templateArgs:r.templateArgs,templateArgsPos:r.templateArgsPos},tokens:[e(n)]}:{succeeded:!1,error:!1,src:r.src,pos:r.start,message:`operator "objSequence(${n})"`}}}function ce(e,t){return(...n)=>r=>{const o=Math.max(0,r.end-r.start);let s=-1;return o>0&&n.some((e,n)=>{if(t(r.src[r.start],e))return s=n,!0})?{succeeded:!0,next:{src:r.src,start:r.start+1,end:r.end,context:r.context,templateArgs:r.templateArgs,templateArgsPos:r.templateArgsPos},tokens:[e(n[s])]}:{succeeded:!1,error:!1,src:r.src,pos:r.start,message:`operator "objClass(${n.join(",")})"`}}}function ue(e,t){return(...n)=>r=>{if(Math.max(0,r.end-r.start)>0)for(const e of n){let o=!0;if(!t(r.src[r.start],e)){o=!1;break}if(o)return{succeeded:!1,error:!1,src:r.src,pos:r.start,message:`operator "objClassNot(${n.join(",")})"`}}return{succeeded:!0,next:{src:r.src,start:r.start+1,end:r.end,context:r.context,templateArgs:r.templateArgs,templateArgsPos:r.templateArgsPos},tokens:[e(r.src[r.start])]}}}const fe=ie({rawToToken:e=>e,concatTokens:e=>e.length?[e.reduce((e,t)=>String(e)+t)]:[]}),de=function(e){const t=(n=e.rawToToken,e.comparator,e=>t=>Math.max(0,t.end-t.start)>0&&e(t.src[t.start])?{succeeded:!0,next:{src:t.src,start:t.start+1,end:t.end,context:t.context,templateArgs:t.templateArgs,templateArgsPos:t.templateArgsPos},tokens:[n(t.src[t.start])]}:{succeeded:!1,error:!1,src:t.src,pos:t.start,message:'operator "objClassByNeedleFn"'});var n;const r=t(e=>!0);return{seq:le(e.rawToToken,e.comparator),cls:ce(e.rawToToken,e.comparator),notCls:ue(e.rawToToken,e.comparator),clsFn:t,classes:{any:r},cat:te(e.concatTokens),once:V(1,1),repeat:V(),qty:(e,t)=>V(e,t),zeroWidth:e=>Z(e),err:e=>H(e),beginning:e=>G(e),end:e=>K(e),first:(...e)=>X(...e),or:(...e)=>ee(...e),combine:te(),erase:te(e=>[]),trans:e=>te(e),ahead:(...e)=>ne(...e),behind:(e,t)=>re(e,t),rules:e=>oe(e),makeProgram:se}}({rawToToken:e=>e,concatTokens:e=>e.length?[e.reduce((e,t)=>String(e)+t)]:[],comparator:(e,t)=>e===t}),{seq:pe,cls:me,notCls:he,clsFn:ge,classes:ye,numbers:we,isParam:be,cat:ve,once:Ae,repeat:ke,qty:xe,zeroWidth:Ne,err:_e,beginning:Ce,end:Fe,first:Pe,or:Oe,combine:je,erase:Ee,trans:Te,ahead:De,rules:Se,makeProgram:Le}=fe,$e=e=>ge(t=>t.slice(0,e.length).toLocaleLowerCase()===e?e.length:-1),Ie=(e,t,n)=>({type:"condition",op:e,operands:[t,n]}),qe=(e,t)=>"object"==typeof e&&"rawop"===e.type&&e.op===t,Me=je(Ee(xe(2)(me("-"))),Pe(je(ke(he("\r\n","\n","\r")),Pe(ye.newline,De(Fe()))),Pe(ye.newline,De(Fe())))),Re=je(pe("/*"),ke(he("*/")),pe("*/")),Qe=Pe(ye.space,Me,Re),Ue=Pe(je($e("select"),e=>ze(e)),je($e("from"),e=>ze(e)),je($e("where"),e=>ze(e)),ve(je($e("order"),Ee(xe(1)(Qe)),$e("by"))),ve(je($e("group"),Ee(xe(1)(Qe)),$e("by"))),je($e("having"),e=>ze(e)),je($e("offset"),e=>ze(e)),je($e("limit"),e=>ze(e))),Be=De(e=>je(Ue,Pe(xe(1)(Qe),me("(",")","'",'"',"=","!","<",">"),Fe()))(e).succeeded?{succeeded:!1,error:!1,src:e.src,pos:e.start,message:"Unexpected reserved keyword aheads"}:{succeeded:!0,next:{src:e.src,start:e.start,end:e.end,context:e.context},tokens:[]}),We=e=>"string"==typeof e&&/^[A-Za-z0-9$_"]$/.test(e),ze=De(e=>{let t=!1;return t=0===e.src.length||(e.start===e.end?We(e.src[e.start-1]):0===e.start?We(e.src[e.start]):!We(e.src[e.start-1])&&We(e.src[e.start])||We(e.src[e.start-1])&&!We(e.src[e.start])),t?{succeeded:!0,next:{src:e.src,start:e.start,end:e.end,context:e.context},tokens:[]}:{succeeded:!1,error:!1,src:e.src,pos:e.start,message:"Expect word break"}}),Je=Te(e=>[!0])($e("true"),ze),Ye=Te(e=>[!1])($e("false"),ze),Ze=Te(e=>[null])($e("null"),ze),He=Te(e=>[Number.POSITIVE_INFINITY])(xe(0,1)(pe("+")),pe("Infinity"),ze),Ge=Te(e=>[Number.NEGATIVE_INFINITY])(pe("-Infinity"),ze),Ke=Te(e=>[Number.NaN])(pe("NaN"),ze),Ve=Te(e=>[Number.parseInt(e[0].replace(/_/g,""),2)])(we.bin(pe("0b"))),Xe=Te(e=>[Number.parseInt(e[0].replace(/_/g,""),8)])(we.oct(pe("0o"),pe("0"))),et=Te(e=>[Number.parseInt(e[0].replace(/_/g,""),16)])(we.hex(pe("0x"),pe("0X"))),tt=Te(e=>[Number.parseInt(e[0].replace(/_/g,""),10)])(we.int),nt=Te(e=>[Number.parseFloat(e[0].replace(/_/g,""))])(we.float),rt=Pe(Xe,et,Ve,nt,tt,He,Ge,Ke),ot=Pe(Te(e=>["'"])(pe("\\'")),Te(e=>['"'])(pe('\\"')),Te(e=>["`"])(pe("\\`")),Te(e=>["/"])(pe("\\/")),Te(e=>["\\"])(pe("\\\\")),Te(e=>[""])(pe("\\\r\n")),Te(e=>[""])(pe("\\\r")),Te(e=>[""])(pe("\\\n")),Te(e=>["\n"])(pe("\\n")),Te(e=>["\n"])(pe("\\N")),Te(e=>["\r"])(pe("\\r")),Te(e=>["\r"])(pe("\\R")),Te(e=>["\v"])(pe("\\v")),Te(e=>["\t"])(pe("\\t")),Te(e=>["\t"])(pe("\\T")),Te(e=>["\b"])(pe("\\b")),Te(e=>["\b"])(pe("\\B")),Te(e=>["\f"])(pe("\\f")),Te(e=>["\f"])(pe("\\F")),Te(e=>[String.fromCodePoint(Number.parseInt(e[0],16))])(ve(Ee(pe("\\u")),xe(4,4)(ye.hex))),Te(e=>[String.fromCodePoint(Number.parseInt(e[0],16))])(ve(Ee(pe("\\u{")),xe(1,6)(ye.hex),Ee(pe("}")))),Te(e=>[String.fromCodePoint(Number.parseInt(e[0],16))])(ve(Ee(pe("\\x")),xe(2,2)(ye.hex))),Te(e=>[String.fromCodePoint(Number.parseInt(e[0],8))])(ve(Ee(pe("\\")),xe(3,3)(ye.oct)))),st=Te(e=>{var t;return[null!==(t=e[0])&&void 0!==t?t:""]})(Ee(pe("'")),ve(ke(Pe(ot,je(me("\r","\n"),_e("Line breaks within strings are not allowed.")),he("'")))),Ee(pe("'"))),at=Te(e=>[{type:"date",value:e[0]}])(ve(xe(4,4)(ye.num),me("-"),xe(2,2)(ye.num),me("-"),xe(2,2)(ye.num),ze)),it=Te(e=>[{type:"datetime",value:e[0]}])(ve(xe(4,4)(ye.num),me("-"),xe(2,2)(ye.num),me("-"),xe(2,2)(ye.num),me("T"),xe(2,2)(ye.num),me(":"),xe(2,2)(ye.num),xe(0,1)(je(me(":"),xe(2,2)(ye.num))),Pe(me("Z"),je(Pe(me("+"),me("-")),xe(2,2)(ye.num),me(":"),xe(2,2)(ye.num))),ze)),lt=Te(e=>{var t;const n=null!==(t=e[0])&&void 0!==t?t:"";if(c(l,n))throw new Error("Unsafe symbol name is appeared: "+n);return[n]})(Ee(pe('"')),ve(ke(Pe(ot,je(me("\r","\n"),_e("Line breaks within strings are not allowed.")),he('"')))),Ee(pe('"'))),ct=Te(e=>{if(c(l,e[0]))throw new Error("Unsafe symbol name is appeared: "+e[0]);return e})(ve(je(Pe(ye.alpha,me("$","_")),ke(Pe(ye.alnum,me("$","_")))))),ut=Te(e=>[{name:e}])(Pe(ct,lt),ke(je(Ee(ke(Qe),me("."),ke(Qe)),Pe(ct,lt)))),ft=Te(e=>[{type:"parameter",name:e[0]}])(Ee(pe(":")),ct),dt=Pe(be(e=>{switch(typeof e){case"number":case"string":case"boolean":return!0;case"object":if(null===e)return!0;if(e.type)switch(e.type){case"date":if("string"==typeof e.value)return a.test(e.value);break;case"datetime":if("string"==typeof e.value)return i.test(e.value)}}return!1}),it,at,rt,st,Je,Ye,Ze,ft),pt=Te(e=>[{fn:e[0],args:e.slice(1)}])(ct,Ee(ke(Qe)),Ee(me("(")),Ee(ke(Qe)),ke(Pe(Te(e=>[Object.assign({type:"fncall"},e[0])])(e=>pt(e)),dt,Te(e=>[Object.assign({type:"field"},e[0])])(ut))),ke(je(Ee(ke(Qe)),Ee(me(",")),Ee(ke(Qe)),Pe(Te(e=>[Object.assign({type:"fncall"},e[0])])(e=>pt(e)),dt,Te(e=>[Object.assign({type:"field"},e[0])])(ut)))),Ee(ke(Qe)),Ee(me(")"))),mt=Te(e=>[{query:e[0]}])(Ee(me("("),ke(Qe)),e=>Mt(e),Ee(ke(Qe),me(")"))),ht=Te(e=>[e])(Ee(me("("),ke(Qe)),dt,Ee(ke(Qe)),ke(je(Ee(me(","),ke(Qe)),dt)),Ee(ke(Qe),me(")"))),gt=Te(e=>[Object.assign(Object.assign({},e[0]),{aliasName:e.length>1?e[1]:null})])(Be,Pe(Te(e=>[Object.assign({type:"fncall"},e[0])])(pt),Te(e=>[Object.assign({type:"field"},e[0])])(ut),Te(e=>[Object.assign({type:"subquery"},e[0])])(mt)),Pe(je(Ee(ke(Qe)),Be,ct),Ne(()=>null))),yt=Te(e=>[{select:e}])(gt,Ee(ke(Qe)),ke(je(Ee(me(",")),Ee(ke(Qe)),gt,Ee(ke(Qe))))),wt=Te(e=>[{from:e}])(Ee($e("from")),Te(e=>{var t;return[Object.assign(Object.assign({},e[0]),{aliasName:null!==(t=e[1])&&void 0!==t?t:null})]})(Ee(xe(1)(Qe)),Be,ut,xe(0,1)(je(Ee(xe(1)(Qe)),Be,ct))),ke(Te(e=>{var t;return[Object.assign(Object.assign({},e[0]),{aliasName:null!==(t=e[1])&&void 0!==t?t:null})]})(Ee(ke(Qe),me(","),ke(Qe)),Be,ut,Pe(je(Ee(xe(1)(Qe)),Be,ct),Ne(()=>null))))),bt=Pe(pe("!="),pe("<="),pe(">="),pe("="),pe("<"),pe(">"),Te(e=>[`${e[0]}_${e[1]}`])($e("not"),Ee(xe(1)(Qe)),Pe($e("like"),$e("in")),Ee(ze,ke(Qe))),je($e("like"),Ee(ze,ke(Qe))),je($e("in"),Ee(ze,ke(Qe))),je($e("includes"),Ee(ze,ke(Qe))),je($e("excludes"),Ee(ze,ke(Qe)))),vt=de.trans(e=>{return[(t="not",n=e[1],{type:"condition",op:t,operands:[n]})];var t,n})(de.clsFn(e=>qe(e,"not")),de.clsFn(e=>!0)),At=de.trans(e=>[Ie("and",e[0],e[2])])(de.clsFn(e=>!0),de.clsFn(e=>qe(e,"and")),de.clsFn(e=>!0)),kt=de.trans(e=>[Ie("or",e[0],e[2])])(de.clsFn(e=>!0),de.clsFn(e=>qe(e,"or")),de.clsFn(e=>!0)),xt=Te(e=>[{type:"condition",op:e[1],operands:e.slice(0,1).concat(e.slice(2))}])(Be,Pe(Te(e=>[Object.assign({type:"fncall"},e[0])])(pt),Te(e=>[Object.assign({type:"field"},e[0])])(ut)),Ee(ke(Qe)),bt,Ee(ke(Qe)),Pe(dt,Te(e=>[Object.assign({type:"subquery"},e[0])])(mt),Te(e=>[Object.assign({type:"fncall"},e[0])])(pt),ht)),Nt=Te(e=>e)(xe(0,1)(je(Te(e=>[{type:"rawop",op:e[0]}])($e("not")),Ee(ze,ke(Qe)))),Pe(Te(e=>e)(Ee(ke(Qe)),Ee(me("(")),Ee(ke(Qe)),e=>_t(e),Ee(ke(Qe)),Ee(me(")"))),xt),ke(je(Ee(ke(Qe)),Te(e=>[{type:"rawop",op:e[0]}])(Pe($e("and"),$e("or"))),Ee(ze,ke(Qe)),e=>_t(e)))),_t=Se({rules:[vt,At,kt],check:de.combine(de.classes.any,de.end())})(Te(e=>e)(Nt)),Ct=Te(e=>[{where:[e[0]]}])(Ee(ke(Qe),ze),Ee($e("where")),Ee(Pe(De(me("(")),xe(1)(Qe),je(ke(Qe),ze))),_t),Ft=Te(e=>[{groupBy:e}])(Ee(ke(Qe),ze),Ee($e("group"),xe(1)(Qe),$e("by"),xe(1)(Qe)),ct,ke(je(Ee(ke(Qe),me(","),ke(Qe)),ct))),Pt=Te(e=>[{type:"condition",op:e[1],operands:e.slice(0,1).concat(e.slice(2))}])(Be,Te(e=>[Object.assign({type:"fncall"},e[0])])(pt),Ee(ke(Qe)),bt,Ee(ke(Qe)),Pe(dt,Te(e=>[Object.assign({type:"subquery"},e[0])])(mt,Te(e=>[Object.assign({type:"fncall"},e[0])])(pt),ht))),Ot=Te(e=>e)(xe(0,1)(je(Te(e=>[{type:"rawop",op:e[0]}])($e("not")),Ee(ze,ke(Qe)))),Pe(Te(e=>e)(Ee(ke(Qe)),Ee(me("(")),Ee(ke(Qe)),e=>jt(e),Ee(ke(Qe)),Ee(me(")"))),Pt),ke(je(Ee(ke(Qe)),Te(e=>[{type:"rawop",op:e[0]}])(Pe($e("and"),$e("or"))),Ee(ze,ke(Qe)),e=>jt(e)))),jt=Se({rules:[vt,At,kt],check:de.combine(de.classes.any,de.end())})(Te(e=>e)(Ot)),Et=Te(e=>[{having:[e[0]]}])(Ee(ke(Qe),ze),Ee($e("having")),Ee(Pe(De(me("(")),xe(1)(Qe),je(ke(Qe),ze))),jt),Tt=Pe(xe(1,1)(je(Ee(xe(1)(Qe)),Te(e=>[e[0].toLowerCase()])(Pe($e("asc"),$e("desc"))),Ee(ze))),Ne(()=>"asc")),Dt=Pe(xe(1,1)(je(Ee(xe(1)(Qe),$e("nulls"),xe(1)(Qe)),Te(e=>[e[0].toLowerCase()])(Pe($e("first"),$e("last"))),Ee(ze))),Ne(()=>"first")),St=Te(e=>[{orderBy:e}])(Ee(ke(Qe),ze),Ee($e("order"),xe(1)(Qe),$e("by"),xe(1)(Qe)),Te(e=>[Object.assign(Object.assign({},e[0]),{direction:e[1],nulls:e[2]})])(ut,Tt,Dt),ke(je(Ee(ke(Qe),me(","),ke(Qe)),Te(e=>[Object.assign(Object.assign({},e[0]),{direction:e[1],nulls:e[2]})])(ut,Tt,Dt)))),Lt=Te(e=>[{offset:e[0]}])(Ee(ke(Qe),ze),Ee($e("offset"),xe(1)(Qe)),Pe(tt,ft,be(e=>"number"==typeof e))),$t=Te(e=>[{limit:e[0]}])(Ee(ke(Qe),ze),Ee($e("limit"),xe(1)(Qe)),Pe(tt,ft,be(e=>"number"==typeof e))),It=Te(e=>[{for:e.map(e=>e.toLowerCase())}])(Ee(ke(Qe),ze),Ee($e("for"),xe(1)(Qe)),Pe(je($e("view"),xe(0,1)(je(Ee(ke(Qe),me(","),ke(Qe)),$e("reference")))),je($e("reference"),xe(0,1)(je(Ee(ke(Qe),me(","),ke(Qe)),$e("view"))))),Ee(ze)),qt=Te(e=>[{for:e.map(e=>e.toLowerCase())}])(Ee(ke(Qe),ze),Ee($e("for"),xe(1)(Qe)),$e("update"),Pe(je(Ee(xe(1)(Qe)),$e("tracking"),xe(0,1)(je(Ee(ke(Qe),me(","),ke(Qe)),$e("viewstat")))),je(Ee(xe(1)(Qe)),$e("viewstat"),xe(0,1)(je(Ee(ke(Qe),me(","),ke(Qe)),$e("tracking")))),Ne(()=>{})),Ee(ze)),Mt=Te(e=>{let t={};for(const n of e)t=Object.assign(Object.assign({},t),n);return[t]})(Ee($e("select")),Ee(xe(1)(Qe)),yt,wt,xe(0,1)(Ct),xe(0,1)(je(Ft,xe(0,1)(Et))),xe(0,1)(St),xe(0,1)(Pe(je(Lt,xe(0,1)($t)),je($t,xe(0,1)(Lt)))),xe(0,1)(Pe(It,qt)),Ee(ke(Qe))),Rt=Le(je(Ce(),Ee(ke(Qe)),Mt,Ee(ke(Qe)),Fe()));function Qt(e,t){const n=t.name.slice(0,t.name.length-1);return e.from.find(e=>f(e.name,n))}function Ut(e,t,n,r){var o;const s=null!==(o=Qt(e,t))&&void 0!==o?o:n;s&&r(s).add(t.name[t.name.length-1])}function Bt(e,t){for(const n of e.args)switch(typeof n){case"object":if(null===n);else switch(n.type){case"field":t(n);break;case"fncall":Bt(n,t)}}}function Wt(e,t){switch(e.type){case"condition":for(const n of e.operands)switch(typeof n){case"object":if(null===n);else if(Array.isArray(n));else switch(n.type){case"condition":Wt(n,t);break;case"field":t(n);break;case"fncall":for(const e of n.args)switch(typeof e){case"object":if(null===e);else switch(e.type){case"field":t(e);break;case"fncall":Bt(e,t)}}}}}return e}function zt(e,t,n,r){var o,s,a,i;const l=new Map(null!=r?r:[]);if(0===n.length&&t.from[0].name.length>1)throw new Error("Relationship name is not allowed at first item of root level from clause.");{const e=t.from[0];if(t.from[0].name.length>1)for(;l.has(e.name[0].toLowerCase());)e.name=l.get(e.name[0].toLowerCase()).concat(e.name.slice(1));if(n.length>0&&(e.name=d(n,e.name),!f(e.name.slice(0,n.length),n)))throw new Error(`Resolver name ${e.name.join(".")} is not match to parent resolver ${n.join(".")}`)}const c=t.from[0].name;t.from[0].aliasName&&l.set(t.from[0].aliasName.toLowerCase(),c),t.whereSubQueries=[],t.havingSubQueries=[],t.selectSubQueries=[];for(const e of t.from.slice(1)){if(1===e.name.length)e.name=c.concat(e.name);else{let t=e.name[0].toLowerCase();for(;l.has(t);)e.name=l.get(t).concat(e.name.slice(1)),t=e.name[0].toLowerCase();e.name=d(c,e.name)}e.aliasName&&l.set(e.aliasName.toLowerCase(),e.name)}const u=new Map;let m="select";const h=e=>{switch(m){case"select":e.aliasName&&u.set(e.aliasName.toLowerCase(),e.name);break;case"where":case"having":case"orderby":if(1===e.name.length){const t=e.name[0].toLowerCase();u.has(t)&&(e.name=u.get(t))}}if(1===e.name.length)e.name=c.concat(e.name);else{let n=e.name[0].toLowerCase();for(;l.has(n);)e.name=l.get(n).concat(e.name.slice(1)),n=e.name[0].toLowerCase();e.name=d(c,e.name);const r=e.name.slice(0,e.name.length-1);t.from.find(e=>f(e.name,r))||t.from.push({name:r,aliasName:null})}return e},g=(n,r)=>{const o=n.fn.toLowerCase(),s=e.functions.find(e=>e.name.toLowerCase()===o);if(!s)throw new Error(`Function '${n.fn}' is not found.`);switch(m){case"select":"aggregate"!==s.type||t.groupBy||(t.groupBy=[]);break;case"where":if("aggregate"===s.type)throw new Error(`Aggregate function '${n.fn}' is not allowed.`);if(0!==r&&"immediate-scalar"!==s.type)throw new Error(`Function '${n.fn}' is not allowed at operand ${r+1}.`);break;case"having":if(0!==r&&"immediate-scalar"!==s.type)throw new Error(`Function '${n.fn}' is not allowed at operand ${r+1}.`)}for(const e of n.args)switch(typeof e){case"object":if(null===e);else switch(e.type){case"field":h(e);break;case"fncall":g(e,0)}}return n},y=n=>{switch(n.type){case"condition":for(let r=0;r<n.operands.length;r++){const o=n.operands[r];switch(typeof o){case"object":if(null===o);else if(Array.isArray(o));else switch(o.type){case"condition":y(o);break;case"field":h(o);break;case"fncall":g(o,r);break;case"subquery":("where"===m?t.whereSubQueries:t.havingSubQueries).push(o),o.query=zt(e,o.query,[],null)}}}}return n};for(let n=0;n<t.select.length;n++){const r=t.select[n];switch(r.type){case"field":h(r);break;case"fncall":g(r,n);break;case"subquery":t.selectSubQueries.push(r),r.query=zt(e,r.query,c,l)}}if(t.where&&(m="where",y(t.where[0])),t.having&&(m="having",y(t.having[0])),t.orderBy){m="orderby";for(const e of t.orderBy)h(e)}for(const e of t.from)e.queryFields=new Set,e.queryFieldsMap=new Map,e.condFields=new Set,e.condAliasFields=new Set,e.havingCondFields=new Set,e.relationshipIdFields=new Set;const w=e=>Ut(t,e,t.from[0],e=>e.queryFields),b=e=>Ut(t,e,t.from[0],e=>e.condFields),v=e=>Ut(t,e,t.from[0],e=>e.havingCondFields);let k=0;const x=(e,n)=>{n||e.aliasName||(e.aliasName="expr"+k++);let r=void 0;for(const n of e.args)switch(typeof n){case"object":if(null===n);else switch(n.type){case"field":w(n),r||(r=Qt(t,n));break;case"fncall":{const e=x(n,!0);r||(r=e)}}}return n||(null!=r?r:t.from[0]).queryFieldsMap.set(e.aliasName,e),r};for(const e of t.select)switch(e.type){case"field":{w(e);const n=Qt(t,e);null==n||n.queryFieldsMap.set(e.name[e.name.length-1],e)}break;case"fncall":x(e,!1)}if(t.where&&Wt(t.where[0],b),t.having&&Wt(t.having[0],v),t.groupBy)for(const e of t.groupBy)t.from[0].havingCondFields.add(e);t.from[0].name=c;const N=p(e.relationships,c[0]);if(!N)throw new Error(`Resolver '${c[0]}' is not found.`);const _=function e(t,n,r){const o=r.resolverName.toLowerCase(),s=r.fieldOrRelName.toLowerCase(),a=p(t.relationships,r.resolverName);if(!a)throw new Error(`Resolver '${r.resolverName}' is not found.`);const i=n.find(e=>e.resolverName.toLowerCase()===o&&e.fieldOrRelName.toLowerCase()===s);if(i)return i;const l=[],c={fieldOrRelName:r.fieldOrRelName,resolverName:a,direction:r.direction,children:l},u=t.relationships[a],f=n.concat([c]);for(const n of Object.keys(u)){const r=u[n];Array.isArray(r)?l.push(e(t,f,{resolverName:r[0],fieldOrRelName:n,direction:2})):"string"==typeof r?l.push(e(t,f,{resolverName:r,fieldOrRelName:n,direction:1})):l.push(e(t,f,{resolverName:r.resolver,fieldOrRelName:n,direction:1}))}return c}(e,[],{resolverName:N,fieldOrRelName:N,direction:1});for(const n of t.from){let t,r=[_];for(let e=0;e<n.name.length;e++){const o=n.name[e],s=o.toLowerCase(),a=r.find(e=>e.fieldOrRelName.toLowerCase()===s);if(!a)throw new Error(`Resolver '${o}' is not found.`);t=a,r=a.children,n.name[e]=a.fieldOrRelName}t&&(n.resolver=e.resolvers.query[t.resolverName],n.resolverName=t.resolverName)}if(t.where){const e=[];A(e,"and",t.where[0]),t.where=e}if(t.having){const e=[];A(e,"and",t.having[0]),t.having=e}t.from=t.from.slice(0,1).concat(t.from.slice(1).sort((e,t)=>e.name.length-t.name.length));for(let n=0;n<t.from.length;n++){const r=t.from[n];r.fieldAliasNames=new Set(Array.from(r.queryFieldsMap.entries()).map(e=>{const t=e[1];return t.aliasName&&!r.queryFields.has(t.aliasName)?t.aliasName.toLowerCase():""}).filter(e=>!!e));for(const e of r.fieldAliasNames)r.condFields.has(e)&&(r.condFields.delete(e),r.condAliasFields.add(e));r.sortFieldNames=new Set(t.orderBy?t.orderBy.filter(e=>r.name.length+1===e.name.length&&f(r.name,e.name.slice(0,r.name.length))).filter(e=>!r.fieldAliasNames.has(e.name[e.name.length-1].toLowerCase())).map(e=>e.name[e.name.length-1]):[]);{const l=null!==(o=r.resolverName)&&void 0!==o?o:"";for(let o=n+1;o<t.from.length;o++){const n=t.from[o];if(r.name.length+1===n.name.length&&f(r.name,n.name.slice(0,r.name.length))){const t=null!==(s=n.resolverName)&&void 0!==s?s:"",o=null!==(i=(null!==(a=e.relationships[l])&&void 0!==a?a:{})[t])&&void 0!==i?i:{},c=o.id?o.id:e.rules.foreignIdFieldName(t);c&&r.relationshipIdFields.add(c)}}}}return t}function Jt(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())-t)/864e5+1}function Yt(e){const t=Date.UTC(e.getFullYear(),0,1);return(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())-t)/864e5+1}const Zt={type:"scalar",name:"cast_to_string",fn:(e,t,n)=>{if(t.length>0)return null===t[0]?null:String(t[0]);throw new Error('Argument of function "cast_to_string" should be field.')}},Ht={type:"scalar",name:"cast_to_number",fn:(e,t,n)=>{if(t.length>0)return null===t[0]?null:Number(t[0]);throw new Error('Argument of function "cast_to_number" should be field.')}},Gt={type:"scalar",name:"cast_to_boolean",fn:(e,t,n)=>{if(t.length>0)return null===t[0]?null:Boolean(t[0]);throw new Error('Argument of function "cast_to_boolean" should be field.')}},Kt={type:"scalar",name:"concat",fn:(e,t,n)=>{if(t.length>0){const e=t.filter(e=>null!==e);return 0===e.length?null:e.map(e=>String(e)).join("")}throw new Error('Argument of function "concat" should be field.')}},Vt={type:"scalar",name:"add",fn:(e,t,n)=>{if(t.length>1){const e=t.filter(e=>null!==e);return 0===e.length?null:e.map(e=>Number(e)).reduce((e,t)=>e+t)}throw new Error('Argument of function "add" should be field.')}},Xt={type:"scalar",name:"sub",fn:(e,t,n)=>{if(t.length>1)return null===t[0]?null:t.filter(e=>null!==e).map(e=>Number(e)).reduce((e,t)=>e-t);throw new Error('Argument of function "sub" should be field.')}},en={type:"scalar",name:"mul",fn:(e,t,n)=>{if(t.length>1){const e=t.filter(e=>null!==e);return 0===e.length?null:e.map(e=>Number(e)).reduce((e,t)=>e*t)}throw new Error('Argument of function "mul" should be field.')}},tn={type:"scalar",name:"div",fn:(e,t,n)=>{if(t.length>1)return null===t[0]?null:t.filter(e=>null!==e).map(e=>Number(e)).reduce((e,t)=>e/t);throw new Error('Argument of function "div" should be field.')}},nn={type:"scalar",name:"mod",fn:(e,t,n)=>{if(t.length>1)return null===t[0]?null:t.filter(e=>null!==e).map(e=>Number(e)).reduce((e,t)=>e%t);throw new Error('Argument of function "div" should be field.')}},rn={type:"aggregate",name:"count",fn:(e,t,n)=>{if(0===t.length)return n.length;{const e=t[0];if(Array.isArray(e))return e.filter(e=>null!=e).length;throw new Error('Argument of function "count" should be field.')}}},on={type:"aggregate",name:"count_distinct",fn:(e,t,n)=>{if(t.length>0){const e=t[0];if(Array.isArray(e)){const t=e.filter(e=>null!=e).map(e=>JSON.stringify(e));return new Set(t).size}}throw new Error('Argument of function "count_distinct" should be field.')}},sn={type:"aggregate",name:"sum",fn:(e,t,n)=>{if(t.length>0){const e=t[0];if(Array.isArray(e)){const t=e.filter(e=>"number"==typeof e&&!Number.isNaN(e));return t.length?t.reduce((e,t)=>e+t):null}}throw new Error('Argument of function "sum" should be field.')}},an={type:"aggregate",name:"avg",fn:(e,t,n)=>{if(t.length>0){const e=t[0];if(Array.isArray(e)){const t=e.filter(e=>"number"==typeof e&&!Number.isNaN(e));return t.length?t.reduce((e,t)=>e+t)/t.length:null}}throw new Error('Argument of function "avg" should be field.')}},ln={type:"aggregate",name:"max",fn:(e,t,n)=>{if(t.length>0){const e=t[0];if(Array.isArray(e)){const t=e.filter(e=>"number"==typeof e&&!Number.isNaN(e)||"string"==typeof e);return t.length?t.reduce((e,t)=>e>t?e:t):null}}throw new Error('Argument of function "max" should be field.')}},cn={type:"aggregate",name:"min",fn:(e,t,n)=>{if(t.length>0){const e=t[0];if(Array.isArray(e)){const t=e.filter(e=>"number"==typeof e&&!Number.isNaN(e)||"string"==typeof e);return t.length?t.reduce((e,t)=>e<t?e:t):null}}throw new Error('Argument of function "min" should be field.')}};function un(e,t){return(n,r,o)=>{if(r.length>0){const e=r[0];switch(typeof e){case"object":if(null===e)return null;switch(e.type){case"date":case"datetime":return t(e.value);default:return null}case"string":return a.test(e)||i.test(e)?t(e):null}}throw new Error(`Argument of function "${e}" should be field.`)}}const fn={type:"scalar",name:"convertTimezone",fn:un("convertTimezone",e=>{const t=new Date(e),n=60*t.getTimezoneOffset()*1e3;return new Date(t.getTime()-n).toISOString()})},dn={type:"scalar",name:"calendar_month",fn:un("calendar_month",e=>new Date(e).getUTCMonth()+1)},pn={type:"scalar",name:"calendar_month_lc",fn:un("calendar_month_lc",e=>new Date(e).getMonth()+1)},mn={type:"scalar",name:"calendar_quarter",fn:un("calendar_quarter",e=>Math.floor(new Date(e).getUTCMonth()/3)+1)},hn={type:"scalar",name:"calendar_quarter_lc",fn:un("calendar_quarter_lc",e=>Math.floor(new Date(e).getMonth()/3)+1)},gn={type:"scalar",name:"calendar_year",fn:un("calendar_year",e=>new Date(e).getUTCFullYear())},yn={type:"scalar",name:"calendar_year_lc",fn:un("calendar_year_lc",e=>new Date(e).getFullYear())},wn={type:"scalar",name:"day_in_month",fn:un("day_in_month",e=>new Date(e).getUTCDate())},bn={type:"scalar",name:"day_in_month_lc",fn:un("day_in_month_lc",e=>new Date(e).getDate())},vn={type:"scalar",name:"day_in_week",fn:un("day_in_week",e=>new Date(e).getUTCDay()+1)},An={type:"scalar",name:"day_in_week_lc",fn:un("day_in_week_lc",e=>new Date(e).getDay()+1)},kn={type:"scalar",name:"day_in_year",fn:un("day_in_year",e=>Jt(new Date(e)))},xn={type:"scalar",name:"day_in_year_lc",fn:un("day_in_year_lc",e=>Yt(new Date(e)))},Nn={type:"scalar",name:"day_only",fn:un("day_only",e=>new Date(e).toISOString().split("T")[0])},_n={type:"scalar",name:"day_only_lc",fn:un("day_only_lc",e=>{const t=new Date(e);return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())).toISOString().split("T")[0]})},Cn={type:"scalar",name:"hour_in_day",fn:un("hour_in_day",e=>new Date(e).getUTCHours())},Fn={type:"scalar",name:"hour_in_day_lc",fn:un("hour_in_day_lc",e=>new Date(e).getHours())},Pn={type:"scalar",name:"week_in_month",fn:un("week_in_month",e=>Math.floor((new Date(e).getUTCDate()-1)/7)+1)},On={type:"scalar",name:"week_in_month_lc",fn:un("week_in_month_lc",e=>Math.floor((new Date(e).getDate()-1)/7)+1)},jn=[Zt,Ht,Gt,Kt,Vt,Xt,en,tn,nn,rn,on,sn,an,ln,cn,fn,dn,mn,gn,wn,vn,kn,Nn,Cn,Pn,{type:"scalar",name:"week_in_year",fn:un("week_in_year",e=>Math.floor((Jt(new Date(e))-1)/7)+1)},pn,hn,yn,bn,An,xn,_n,Fn,On,{type:"scalar",name:"week_in_year_lc",fn:un("week_in_year_lc",e=>Math.floor((Yt(new Date(e))-1)/7)+1)}],En={idFieldName:()=>"Id",foreignIdFieldName:e=>e?e+"Id":void 0};function Tn(e,t,...n){return function(e,t){return zt(e,t,[],null)}(e,function(e,...t){const n=Rt("string"==typeof e?J(e,{}):function(e,t,n){const r=[];let o=0;if(t.length)for(let n=0;n<e.length;n++){const s=e[n];n<t.length&&(r.push(o+s.length),o+=s.length+1)}const s=e.join("\0");return{src:s,start:0,end:s.length,context:n,templateArgs:t,templateArgsPos:r}}(e,t,{}));if(!n.succeeded)throw new Error(Y(n));return n.tokens[0]}(t,...n))}var Dn=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function i(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}l((r=r.apply(e,t||[])).next())}))};function Sn(e,t,n,r,o,s){return Dn(this,void 0,void 0,(function*(){const a=[];o.forEach(e=>function e(t,n){switch(n.type){case"condition":for(let r=0;r<n.operands.length;r++){const o=n.operands[r];switch(typeof o){case"object":if(null===o);else if(Array.isArray(o));else switch(o.type){case"condition":e(t,o);break;case"subquery":t.push({cond:n,index:r,subQuery:o})}}}}return n}(a,e));const i=a.map(o=>Rn(e,t,n,r,o.subQuery.query,null,null,null,s).then(e=>({cond:o.cond,index:o.index,subQuery:o.subQuery,result:e})));(yield Promise.all(i)).map(e=>{var t;const n=e.subQuery.query.select[0];let r="";switch(n.type){case"field":r=n.name[n.name.length-1];break;default:r=null!==(t=n.aliasName)&&void 0!==t?t:""}if(e.result.length){const t=new Map(Object.keys(e.result[0]).map(e=>[e.toLowerCase(),e]));e.cond.operands[e.index]=e.result.map(e=>h(t,e,r))}else e.cond.operands[e.index]=[]})}))}function Ln(e,t,n,r){const o=new Array(t.queryFieldsMap.size),s=new Array(t.queryFieldsMap.size),a=(t,n,r,o)=>{const a=s[t];o[r.aliasName]=F(e,r,a,"any",o,null)},i=(t,n,r,o)=>{const a=s[t];o[r.aliasName]=P(e,r,a,"any",o,null)},l=(e,t,n,r)=>{};{let n=0;for(const c of t.queryFieldsMap.entries()){const[t,u]=c;switch(u.type){case"field":o[n]={isField:!0,fieldName:t,field:u,fn:l};break;case"fncall":if(r)o[n]={isField:!1,fieldName:t,field:u,fn:l};else{const r=u.fn.toLowerCase(),c=e.functions.find(e=>e.name.toLowerCase()===r);switch(s[n]=c,null==c?void 0:c.type){case"scalar":o[n]={isField:!1,fieldName:t,field:u,fn:a};break;case"immediate-scalar":o[n]={isField:!1,fieldName:t,field:u,fn:i};break;default:o[n]={isField:!1,fieldName:t,field:u,fn:l}}}break;default:o[n]={isField:!1,fieldName:t,field:u,fn:l}}n++}}for(const e of n)for(let t=0;t<o.length;t++){const{isField:n,fieldName:r,field:s,fn:a}=o[t];n?s.aliasName&&(e[s.aliasName]=e[r]):a(t,r,s,e)}return n}function $n(e,t,n,r){if(0===r.length)return[];if(1===r.length||0===t.length)return[r];const o=new Map;if(r.length){let e=0;const n=new Map(Object.keys(r[0]).map(e=>[e.toLowerCase(),e]));for(const s of r){const r=[];for(const o of t){let t=h(n,s,o);null==t&&(t="__$$GENSYM_VT4iHbNbZW3C7taC7J6bx8pruw40cX5X$$_"+e++),r.push(t)}const a=JSON.stringify(r);if(o.has(a)){o.get(a).push(s)}else o.set(a,[s])}}return Array.from(o.values())}function In(e,t,n,r){var o,s;const a=[];if(!r.length)return a;const i=r[0][0],l=new Map(t.map(e=>{var t;return[e.toLowerCase(),null!==(t=p(i,e))&&void 0!==t?t:""]})),c=new Array(n.queryFieldsMap.size),u=new Array(n.queryFieldsMap.size),f=(t,n,r,o)=>{const s=u[t];o[n.aliasName]=O(e,n,s,"any",r)},d=(t,n,r,o)=>{const s=u[t];o[n.aliasName]=P(e,n,s,"any",null,r)},m=(t,n,r,o)=>{const s=u[t];o[n.aliasName]=F(e,n,s,"any",r[0],r)},h=(e,t,n,r)=>{};{let t=0;for(const r of n.queryFieldsMap.entries()){const[,n]=r;switch(n.type){case"field":{const e=j(l,n.name[n.name.length-1]);if(!e)throw new Error(n.name.join(".")+" is not allowed. Aggregate function is needed.");c[t]={isField:!0,field:n,trueCaseName:e,fn:h}}break;case"fncall":{const r=n.fn.toLowerCase(),a=e.functions.find(e=>e.name.toLowerCase()===r);switch(u[t]=a,null==a?void 0:a.type){case"aggregate":c[t]={isField:!1,field:n,trueCaseName:"",fn:f};break;case"immediate-scalar":c[t]={isField:!1,field:n,trueCaseName:"",fn:d};break;case"scalar":if(!E(e,l,n.args))throw new Error((null!==(o=n.aliasName)&&void 0!==o?o:"(unnamed)")+" is not allowed. Aggregate function is needed.");c[t]={isField:!1,field:n,trueCaseName:"",fn:m};break;default:throw new Error((null!==(s=n.aliasName)&&void 0!==s?s:"(unnamed)")+" is not allowed. Aggregate function is needed.")}}break;default:c[t]={isField:!1,field:n,trueCaseName:"",fn:h}}t++}}for(const e of r){const t={};for(let n=0;n<c.length;n++){const{isField:r,field:o,trueCaseName:s,fn:a}=c[n];r?(t[s]=e[0][s],o.aliasName&&(t[o.aliasName]=e[0][s])):a(n,o,e,t)}a.push(t)}return a}function qn(e,t,n){const r=new Set;if(t.length){const o=new Set,s=t[0];for(const t of e.queryFieldsMap.entries()){const e=t[1];if(n&&"field"===e.type&&e.aliasName)o.add(e.aliasName);else{const e=p(s,t[0]);e&&o.add(e)}}for(const e of Object.keys(s))o.has(e)||r.add(e)}return r}function Mn(e,t,n,r){var o,s,a,i;const l=0===r?"master":"detail",c=JSON.stringify(n.name.slice(0,n.name.length-1)),u=JSON.stringify(n.name),f=null!==(o=n.resolverName)&&void 0!==o?o:"",d=t.get(c),p=null!==(i=0===r?(null!==(s=e.relationships[f])&&void 0!==s?s:{})[d]:(null!==(a=e.relationships[d])&&void 0!==a?a:{})[f])&&void 0!==i?i:{};return{parentType:l,parentKey:c,currentKey:u,resolverName:f,parentResolverName:d,masterRelationshipInfo:p,foreignIdField:"object"==typeof p&&p.id?p.id:0===r?e.rules.foreignIdFieldName(d):e.rules.foreignIdFieldName(f),parentIdFieldName:d?e.rules.idFieldName(d):void 0,currentIdFieldName:e.rules.idFieldName(f)}}function Rn(e,t,n,r,o,s,a,i,l){return Dn(this,void 0,void 0,(function*(){let c,f;const d=null!=a?a:new Map,p=null!=i?i:new Map,m=null!=l?l:{},{limit:h,offset:g}=function(e,t,n){var r,o;if(n=null!=n?n:null,null!==(t=null!=t?t:null)&&"object"==typeof t){if(!Object.prototype.hasOwnProperty.call(e,t.name))throw new Error(`Parameter '${t.name}' is not found.`);const n=null!==(r=e[t.name])&&void 0!==r?r:null;if("number"!=typeof n)throw new Error(`Parameter '${t.name}' should be number.`);t=n}if(null!==n&&"object"==typeof n){if(!Object.prototype.hasOwnProperty.call(e,n.name))throw new Error(`Parameter '${n.name}' is not found.`);const t=null!==(o=e[n.name])&&void 0!==o?o:null;if("number"!=typeof t)throw new Error(`Parameter '${n.name}' should be number.`);n=t}return{limit:t,offset:n}}(t,o.limit,o.offset);!s&&e.events.beginExecute&&(yield e.events.beginExecute({resolverData:m,transactionData:n,transactionOptions:r}));try{const a=o.where?u(o.where):[],i=o.having?u(o.having):[];yield Sn(e,t,n,r,a,m),yield Sn(e,t,n,r,i,m);const l=[],y=new Map;for(let w=0;w<o.from.length;w++){const A=o.from[w],{parentType:k,parentKey:x,currentKey:N,resolverName:_,parentResolverName:C,foreignIdField:F,parentIdFieldName:P,currentIdFieldName:O}=Mn(e,p,A,w);if(!A.resolver)throw new Error(`Resolver name ${A.name.join(".")} is not resolved.`);let j=[];const E=d.get(x),T=A.condAliasFields.size>0,D=!(0!==w||!o.groupBy),S=Array.from(A.queryFields.values()),L=Array.from(A.condFields.values()),$=Array.from(A.havingCondFields.values()),I=0===w&&o.groupBy?o.groupBy:[],q=Array.from(A.sortFieldNames.values()),M=Array.from(A.relationshipIdFields.values()),R=Array.from(new Set(S.concat(L).concat($).concat(e.rules.idFieldName?[e.rules.idFieldName(_)]:[]).concat(I).concat(q).concat(M)).values()),B=u(a).map(e=>v(A.name,e)).filter(b),W=u(i).map(e=>v(A.name,e)).filter(b),z={functions:e.functions,query:o,params:t,graphPath:A.name,resolverName:_,parentResolverName:C,parentType:k,foreignIdField:F,masterIdField:0===w?P:O,detailIdField:0===w?O:P,parentRecords:E,conditions:B,resolverData:m,transactionData:n,transactionOptions:r};if(0===w){const e=Object.assign(Object.assign({},z),{parent:s,resolverCapabilities:{filtering:!1,sorting:!1,limit:!1,offset:!1}});if(j=yield A.resolver(R,T?[]:B,D||T?null:h,D||T?null:g,e),f=e.resolverCapabilities,T&&(f.filtering=!1,f.limit=!1,f.offset=!1,f.sorting=!1),T&&(j=Ln(z,A,j,D)),e.resolverCapabilities.filtering||(j=Q(z,B,j)),T||(j=Ln(z,A,j,D)),D){f.limit=!1,f.offset=!1,f.sorting=!1;const e=U(z,W,$n(0,I,0,j));j=In(z,I,A,e)}c=j}else if(E&&E.length){e.events.beforeMasterSubQueries&&(yield e.events.beforeMasterSubQueries(z));const t=A.name[A.name.length-1];for(const e of E){const n=Object.assign(Object.assign({},z),{parent:e,resolverCapabilities:{filtering:!1,sorting:!1,limit:!1,offset:!1}});let r=(yield A.resolver(R,T?[]:B,1,0,n)).slice(0,1);T&&(n.resolverCapabilities.filtering=!1,n.resolverCapabilities.limit=!1,n.resolverCapabilities.offset=!1,n.resolverCapabilities.sorting=!1),T&&(r=Ln(z,A,r,D)),n.resolverCapabilities.filtering||(r=Q(z,B,r)),T||(r=Ln(z,A,r,D)),e[t]=r.length>0?r[0]:null,j=j.concat(r)}e.events.afterMasterSubQueries&&(yield e.events.afterMasterSubQueries(z));const n=y.get(x);n&&n.delete(t)}const J=qn(A,j,D);l.push([J,j]),y.set(N,J),d.set(N,j),p.set(N,_)}if(o.selectSubQueries&&c){const s=[];for(const a of o.selectSubQueries){const o=a.query.from[0].name,i=JSON.stringify(o.slice(0,o.length-1)),l=d.get(i);if(l){const{parentType:i,resolverName:c,parentResolverName:u,foreignIdField:f,parentIdFieldName:h,currentIdFieldName:g}=Mn(e,p,a.query.from[0],0),y={functions:e.functions,query:a.query,params:t,graphPath:o,resolverName:c,parentResolverName:u,parentType:i,foreignIdField:f,masterIdField:h,detailIdField:g,parentRecords:l,resolverData:m,transactionData:n,transactionOptions:r};e.events.beforeDetailSubQueries&&(yield e.events.beforeDetailSubQueries(Object.assign({},y)));for(const i of l)s.push(Rn(e,t,n,r,a.query,i,d,p,m).then(e=>({name:o,parent:i,result:e})));e.events.afterDetailSubQueries&&(yield e.events.afterDetailSubQueries(Object.assign({},y)))}const c=y.get(i);c&&c.delete(o[o.length-1])}(yield Promise.all(s)).forEach(e=>{e.parent[e.name[e.name.length-1]]=e.result})}c?f&&(f.sorting||(c=W(o,c)),f.offset||f.limit?f.offset?f.limit||"number"==typeof h&&(c=c.slice(0,h)):"number"==typeof g&&(c=c.slice(g)):"number"==typeof g&&"number"==typeof h?c=c.slice(g,g+h):"number"==typeof g?c=c.slice(g):"number"==typeof h&&(c=c.slice(0,h))):c=[];for(const e of l){const[t,n]=e;for(const e of n)for(const n of t)delete e[n]}!s&&e.events.endExecute&&(yield e.events.endExecute({resolverData:m,transactionData:n,transactionOptions:r},null))}catch(t){throw!s&&e.events.endExecute&&(yield e.events.endExecute({resolverData:m,transactionData:n,transactionOptions:r},t)),t}return c}))}var Qn=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function i(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}l((r=r.apply(e,t||[])).next())}))};var Un=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function i(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}l((r=r.apply(e,t||[])).next())}))};class Bn{constructor(e,t){this.query=e,this.runCompiledQuery=t}execute(e){return this.runCompiledQuery(this.query,e)}}function Wn(e){const t=function(e){const t=Object.assign({},e);t.relationships||(t.relationships={});for(const e of Object.keys(t.resolvers.query))t.relationships[e]||(t.relationships[e]={});return t.resolvers.insert||(t.resolvers.insert={}),t.resolvers.update||(t.resolvers.update={}),t.resolvers.remove||(t.resolvers.remove={}),t.functions||(t.functions=[]),t.functions=t.functions.concat(jn),t.rules||(t.rules={}),t.rules=Object.assign(Object.assign({},En),t.rules),t.events||(t.events={}),t}(e),n={};class r{constructor(){this.eventQueue=[]}publish(e,r,o){const s=n[e];if(s&&s.size){{const t=s.get(null);if(t)for(const n of t.values())this.eventQueue.push({on:r,resolver:e,id:null,fn:n})}const n=t.rules.idFieldName(e);for(const t of o){const o=t[n],a=s.get(o);if(a)for(const t of a.values())this.eventQueue.push({on:r,resolver:e,id:o,fn:t})}}}toPublishFn(){return(e,t,n)=>this.publish(e,t,n)}fire(){if(this.eventQueue.length){const e=this.eventQueue;this.eventQueue=[],setTimeout(()=>{for(const t of e)try{t.fn({on:t.on,resolver:t.resolver,id:t.id})}catch(e){}},0)}}}function o(e,t,r){n[e]||(n[e]=new Map);const o=n[e];o.has(t)||o.set(t,new Set);o.get(t).add(r)}function s(e,t,r){if(!n[e])return;const o=n[e];if(!o.has(t))return;o.get(t).delete(r)}function a(e,t){if(!n[e])return;const r=n[e];for(const[,e]of r.entries())e.delete(t)}return function e(n,i,l,c){const u=null==l?void 0:l.toPublishFn();function f(e,n,r,o){return Un(this,void 0,void 0,(function*(){try{t.events.beginTransaction&&(yield t.events.beginTransaction({resolverData:{},transactionData:e,transactionOptions:n}));const s=yield o(e,n,r.toPublishFn());return t.events.endTransaction&&(yield t.events.endTransaction({resolverData:{},transactionData:e,transactionOptions:n},null)),r.fire(),s}catch(r){try{t.events.endTransaction&&(yield t.events.endTransaction({resolverData:{},transactionData:e,transactionOptions:n},r))}catch(e){}throw r}}))}function d(e,o){return Un(this,void 0,void 0,(function*(){const s=(n,r,s)=>Un(this,void 0,void 0,(function*(){const a=yield Rn(t,null!=o?o:{},n,r,e,null,null,null,null);return e.for&&(e.for.includes("view")||e.for.includes("reference"))&&s(e.from[0].resolverName[e.from[0].resolverName.length-1],"update",a),a}));return c?yield f({},void 0,new r,s):yield s(n,i,u)}))}function p(e,t,n){return Un(this,void 0,void 0,(function*(){const o=(r,o,s)=>{const a=Array.isArray(n)?n:[n];return s(e,t,a),Promise.resolve()};return c?yield f({},void 0,new r,o):yield o(0,0,u)}))}return{compile:function(e,...n){const r=Tn(t,e,...n);return new Bn(r,d)},soql:function(e,...o){return Un(this,void 0,void 0,(function*(){const s=(n,r,s)=>Un(this,void 0,void 0,(function*(){const a=Tn(t,e,...o),i=yield Rn(t,{},n,r,a,null,null,null,null);return a.for&&(a.for.includes("view")||a.for.includes("reference"))&&s(a.from[0].resolverName[a.from[0].resolverName.length-1],"update",i),i}));return c?yield f({},void 0,new r,s):yield s(n,i,u)}))},insert:function(e,o){return Un(this,void 0,void 0,(function*(){const s=(n,r,s)=>Un(this,void 0,void 0,(function*(){const a=Array.isArray(o),i=yield function(e,t,n,r,o){return Qn(this,void 0,void 0,(function*(){const s=e.resolvers.insert;let a=null;for(const e of Object.keys(s))e.toLowerCase()===r.toLowerCase()&&(a=s[e]);if(!a)throw new Error(`Resolver name ${r} is not resolved.`);const i={resolverData:{},transactionData:t,transactionOptions:n};e.events.beginExecute&&(yield e.events.beginExecute(i));let l=null;try{const s={functions:e.functions,graphPath:[],resolverName:r,resolverData:i.resolverData,transactionData:t,transactionOptions:n,resolverCapabilities:{filtering:!1,sorting:!1,limit:!1,offset:!1}};l=yield a(o,s),e.events.endExecute&&(yield e.events.endExecute(i,null))}catch(t){throw e.events.endExecute&&(yield e.events.endExecute(i,t)),t}return l}))}(t,n,r,e,a?o:[o]);return s(e,"insert",i),a?i:i[0]}));return c?yield f({},void 0,new r,s):yield s(n,i,u)}))},update:function(e,o){return Un(this,void 0,void 0,(function*(){const s=(n,r,s)=>Un(this,void 0,void 0,(function*(){const a=Array.isArray(o),i=yield function(e,t,n,r,o){return Qn(this,void 0,void 0,(function*(){const s=e.resolvers.update;let a=null;for(const e of Object.keys(s))e.toLowerCase()===r.toLowerCase()&&(a=s[e]);if(!a)throw new Error(`Resolver name ${r} is not resolved.`);const i={resolverData:{},transactionData:t,transactionOptions:n};e.events.beginExecute&&(yield e.events.beginExecute(i));let l=null;try{const s={functions:e.functions,graphPath:[],resolverName:r,resolverData:i.resolverData,transactionData:t,transactionOptions:n,resolverCapabilities:{filtering:!1,sorting:!1,limit:!1,offset:!1}};l=yield a(o,s),e.events.endExecute&&(yield e.events.endExecute(i,null))}catch(t){throw e.events.endExecute&&(yield e.events.endExecute(i,t)),t}return l}))}(t,n,r,e,a?o:[o]);return s(e,"update",i),a?i:i[0]}));return c?yield f({},void 0,new r,s):yield s(n,i,u)}))},remove:function(e,o){return Un(this,void 0,void 0,(function*(){const s=(n,r,s)=>Un(this,void 0,void 0,(function*(){const a=Array.isArray(o)?o:[o];yield function(e,t,n,r,o){return Qn(this,void 0,void 0,(function*(){const s=e.resolvers.remove;let a=null;for(const e of Object.keys(s))e.toLowerCase()===r.toLowerCase()&&(a=s[e]);if(!a)throw new Error(`Resolver name ${r} is not resolved.`);const i={resolverData:{},transactionData:t,transactionOptions:n};e.events.beginExecute&&(yield e.events.beginExecute(i));try{const s={functions:e.functions,graphPath:[],resolverName:r,resolverData:i.resolverData,transactionData:t,transactionOptions:n,resolverCapabilities:{filtering:!1,sorting:!1,limit:!1,offset:!1}};yield a(o,s),e.events.endExecute&&(yield e.events.endExecute(i,null))}catch(t){throw e.events.endExecute&&(yield e.events.endExecute(i,t)),t}}))}(t,n,r,e,a),s(e,"remove",a)}));return c?yield f({},void 0,new r,s):yield s(n,i,u)}))},touch:function(e,t){return Un(this,void 0,void 0,(function*(){return p(e,"update",t)}))},notifyRemoved:function(e,t){return Un(this,void 0,void 0,(function*(){return p(e,"remove",t)}))},subscribe:o,unsubscribe:s,unsubscribeAllBySubscriber:a,transaction:function(t,n){return Un(this,void 0,void 0,(function*(){const o={},s=new r,a=e(o,n,s,!1);return yield f(o,n,s,(e,n,r)=>Un(this,void 0,void 0,(function*(){yield t({compile:a.compile,soql:a.soql,insert:a.insert,update:a.update,remove:a.remove,touch:a.touch,notifyRemoved:a.notifyRemoved},e)})))}))}}}({},void 0,void 0,!0)}const zn=ie({rawToToken:e=>e,concatTokens:e=>e.length?[e.reduce((e,t)=>e+t)]:[]}),{seq:Jn,cls:Yn,notCls:Zn,classes:Hn,numbers:Gn,cat:Kn,repeat:Vn,end:Xn,first:er,combine:tr,erase:nr,trans:rr,ahead:or,makeProgram:sr}=zn,ar=rr(e=>[Number.parseInt(e[0].replace(/_/g,""),10)])(Gn.int),ir=er(rr(e=>[Number.parseFloat(e[0].replace(/_/g,""))])(Gn.float),ar),lr=rr(e=>[!0])(Jn("true")),cr=rr(e=>[!1])(Jn("false")),ur=rr(e=>e.length?e:[""])(nr(Vn(Hn.spaceWithinSingleLine),Yn('"')),Kn(Vn(er(rr(e=>['"'])(Jn('""')),Zn('"')))),nr(Yn('"'),Vn(nr(Hn.spaceWithinSingleLine)))),fr=rr(e=>e.length?e:[null])(nr(Vn(Hn.spaceWithinSingleLine)),er(lr,cr,ir),nr(Vn(Hn.spaceWithinSingleLine)),or(er(Yn(",","\r\n","\n","\r"),Xn()))),dr=rr(e=>e.length?[e[0]?e[0].trim():""]:[null])(nr(Vn(Hn.spaceWithinSingleLine)),Kn(Vn(er(nr(Hn.spaceWithinSingleLine,or(Yn(",","\r\n","\n","\r"))),Zn(",","\r\n","\n","\r"))))),pr=er(ur,fr,dr),mr=rr(e=>[e])(pr,Vn(tr(nr(Jn(",")),pr))),hr=sr(tr(mr,Vn(tr(nr(Hn.newline),mr)),Xn()));var gr=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function a(e){try{l(r.next(e))}catch(e){s(e)}}function i(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}l((r=r.apply(e,t||[])).next())}))};const yr={noCache:!1,noFiltering:!1,noSorting:!1};function wr(e){Object.assign(yr,e)}function br(e){const t=JSON.parse(e);if(!Array.isArray(t))throw new Error("jsonRecordsParser: Records should be array.");return t}function vr(e){const t=function(e){const t=hr(J(e));if(!t.succeeded)throw new Error(Y(t));return t.tokens}(e.trim());if(!t.length)throw new Error("csvRecordsParser: Header row is needed.");const n=t[0];for(let e=0;e<n.length;e++)if(c(l,n[e]))throw new Error("Unsafe symbol name is appeared: "+n[e]);const r=[];for(let e=1;e<t.length;e++){const o=t[e],s={};for(let e=0;e<n.length;e++)s[n[e]]=o[e];r.push(s)}return r}function Ar(e){return e}function kr(e){return(t,n,r)=>(o,s,a,i,l)=>gr(this,void 0,void 0,(function*(){let c,u=null;l.resolverData.cache?(c=l.resolverData.cache,c.has(t)&&(u=c.get(t))):(c=new Map,r.noCache||(l.resolverData.cache=c));let d=!1,h=null;if(null===u){const r=yield n();h=e(r),c.set(t,h.map(e=>Object.assign({},e)))}else d=!0,h=u;return function(e,t,n,r,o,s,a,i){if(!t.length)return t;const l=new Set,c=new Map(Object.keys(t[0]).map(e=>[e.toLowerCase(),e])),u=new Set(n.map(e=>e.toLowerCase()));for(const e of u.keys())if(!c.has(e))throw new Error(`Field "${e}" is not supplied from resolver "${a.resolverName}".`);if(t.length&&a.parent)switch(a.parentType){case"master":if(a.foreignIdField){const e=m(a.parent,a.masterIdField),n=p(t[0],a.foreignIdField);t=t.filter(t=>t[n]===e)}break;case"detail":if(a.foreignIdField){const e=m(a.parent,a.foreignIdField),n=p(t[0],a.masterIdField);t=t.filter(t=>t[n]===e)}}if(i.noFiltering||(t=Q(a,r,t),a.resolverCapabilities.filtering=!0),e&&(t=t.map(e=>Object.assign({},e))),i.noFiltering)return t;if(!i.noSorting&&a.query&&a.query.orderBy){const e=a.query.from[0].name.length;a.graphPath.length===e&&f(a.graphPath,a.query.from[0].name)&&a.query.orderBy.every(t=>t.name.length===e+1&&c.has(t.name[t.name.length-1].toLowerCase()))&&(t=W(a.query,t),a.resolverCapabilities.sorting=!0)}for(const e of c.keys())u.has(e)||l.add(c.get(e));for(const e of t)for(const t of l)delete e[t];return a.resolverCapabilities.sorting&&("number"==typeof s&&(t=t.slice(s)),"number"==typeof o&&(t=t.slice(0,o)),a.resolverCapabilities.limit=!0,a.resolverCapabilities.offset=!0),t}(d,h,o,s,a,i,l,r)}))}const xr=(e,t,n)=>kr(br)(e,t,null!=n?n:yr),Nr=(e,t,n)=>kr(vr)(e,t,null!=n?n:yr),_r=(e,t,n)=>kr(Ar)(e,t,null!=n?n:yr)}])}));
//# sourceMappingURL=opensoql.min.js.map